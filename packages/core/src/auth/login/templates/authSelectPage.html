<!DOCTYPE html>
<html>
<head>
  <title data-i18n="auth.page.title">Choose Authentication Method</title>
  <meta charset="utf-8">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
      color: #1e293b;
      line-height: 1.6;
    }

    .container {
      background: #ffffff;
      border-radius: 20px;
      padding: 64px 48px;
      max-width: 480px;
      width: 100%;
      box-shadow:
        0 4px 6px -1px rgba(0, 0, 0, 0.05),
        0 2px 4px -1px rgba(0, 0, 0, 0.03);
      border: 1px solid #f1f5f9;
      text-align: center;
    }

    .title {
      font-size: 36px;
      font-weight: 800;
      color: #0f172a;
      margin-bottom: 16px;
      letter-spacing: -0.025em;
      line-height: 1.2;
    }

    .subtitle {
      color: #64748b;
      font-size: 18px;
      font-weight: 400;
      margin-bottom: 48px;
      line-height: 1.5;
    }

    .auth-button {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 16px;
      width: 100%;
      padding: 20px 32px;
      margin: 20px 0;
      border: none;
      border-radius: 12px;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.15s ease;
      position: relative;
      font-family: inherit;
    }

    .feishu-btn {
      background: #ffffff;
      color: #374151;
      border: 2px solid #e5e7eb;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .feishu-btn:hover {
      background: #f9fafb;
      border-color: #0ea5e9;
      color: #0ea5e9;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(14, 165, 233, 0.15);
    }

    .feishu-btn:active {
      transform: translateY(0);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .deepvlab-btn {
      background: #ffffff;
      color: #374151;
      border: 2px solid #e5e7eb;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .deepvlab-btn:hover {
      background: #f9fafb;
      border-color: #1e293b;
      color: #1e293b;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(30, 41, 59, 0.15);
    }

    .deepvlab-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(30, 41, 59, 0.1);
    }

    .cheetah-btn {
      background: #ffffff;
      color: #374151;
      border: 2px solid #e5e7eb;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .cheetah-btn:hover {
      background: #f9fafb;
      border-color: #ff6b35;
      color: #ff6b35;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.15);
    }

    .cheetah-btn:active {
      transform: translateY(0);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .vipcard-btn {
      background: #ffffff;
      color: #374151;
      border: 2px solid #e5e7eb;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .vipcard-btn:hover {
      background: #f9fafb;
      border-color: #f59e0b;
      color: #d97706;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.15);
    }

    .vipcard-btn:active {
      transform: translateY(0);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .icon {
      width: 22px;
      height: 22px;
      display: inline-block;
    }

    .description {
      color: #94a3b8;
      font-size: 15px;
      line-height: 1.6;
      margin-top: 40px;
      padding: 24px;
      background: #f8fafc;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
    }

    .hidden {
      display: none !important;
    }

    /* Ê∂àÊÅØÊèêÁ§∫Ê†∑Âºè */
    .message-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .message-box {
      background: white;
      border-radius: 12px;
      padding: 32px;
      max-width: 500px;
      width: 90%;
      text-align: center;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      animation: messageSlideIn 0.3s ease-out;
    }

    @keyframes messageSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .message-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 16px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
    }

    .message-icon.success {
      background: #dcfce7;
      color: #16a34a;
    }

    .message-icon.error {
      background: #fef2f2;
      color: #dc2626;
    }

    .message-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #1f2937;
    }

    .message-content {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 24px;
      line-height: 1.5;
    }

    .message-button {
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .message-button:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }

    .message-button:active {
      transform: translateY(0);
    }

    /* ‰∏≠ÂõΩIPÈôêÂà∂Ê∂àÊÅØÊ†∑Âºè */
    .china-message {
      background: #fef2f2;
      border: 2px solid #fecaca;
      border-radius: 12px;
      padding: 24px;
      margin: 20px 0;
      text-align: center;
    }

    .china-message-icon {
      width: 48px;
      height: 48px;
      margin: 0 auto 16px;
      background: #dc2626;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
    }

    .china-message-title {
      font-size: 20px;
      font-weight: 600;
      color: #dc2626;
      margin-bottom: 12px;
    }

    .china-message-content {
      color: #7f1d1d;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 8px;
    }

    .auth-buttons-container {
      /* Áî®‰∫éÊéßÂà∂ÊâÄÊúâÁôªÂΩïÊåâÈíÆÁöÑÊòæÁ§∫/ÈöêËóè */
    }

    /* Âä†ËΩΩ‰∏≠Ê†∑Âºè */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #e2e8f0;
      border-top: 3px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      color: #64748b;
      font-size: 16px;
      font-weight: 500;
    }

    /* ÁåéË±πOAË°®ÂçïÊ†∑Âºè */
    .cheetah-form {
      margin-top: 24px;
      padding: 24px;
      background: #f8fafc;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
    }

    .cheetah-form h3 {
      margin: 0 0 20px 0;
      color: #1e293b;
      font-size: 18px;
      font-weight: 600;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      color: #374151;
      font-weight: 500;
      font-size: 14px;
    }

    .form-group input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.2s ease;
      background: white;
      box-sizing: border-box;
    }

    .form-group input:focus {
      outline: none;
      border-color: #ff6b35;
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
    }

    /* VIPÂç°Ë°®ÂçïÁâπÊÆäÊ†∑Âºè */
    .vipcard-form .form-group input:focus {
      border-color: #f59e0b;
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
    }

    .vipcard-form .btn-primary {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }

    .vipcard-form .btn-primary:hover:not(:disabled) {
      background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
    }

    .vipcard-hint {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 8px;
      text-align: left;
    }

    .form-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .btn-primary, .btn-secondary {
      flex: 1;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      background: linear-gradient(135deg, #e55a2b 0%, #de831a 100%);
      transform: translateY(-1px);
    }

    .btn-primary:disabled {
      background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%);
      cursor: not-allowed;
      opacity: 0.6;
    }

    .btn-secondary {
      background: #f1f5f9;
      color: #64748b;
      border: 1px solid #e2e8f0;
    }

    .btn-secondary:hover:not(:disabled) {
      background: #e2e8f0;
      color: #475569;
    }

    .btn-secondary:disabled {
      background: #f8fafc;
      color: #cbd5e1;
      cursor: not-allowed;
      opacity: 0.6;
    }

    @media (max-width: 480px) {
      body {
        padding: 20px 16px;
      }

      .container {
        padding: 40px 32px;
      }

      .title {
        font-size: 32px;
      }

      .subtitle {
        font-size: 16px;
        margin-bottom: 36px;
      }

      .auth-button {
        padding: 18px 24px;
        font-size: 16px;
        gap: 12px;
      }

      .description {
        margin-top: 32px;
        padding: 20px;
        font-size: 14px;
      }
    }

    /* Âä†ËΩΩÂä®Áîª */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .container {
      animation: fadeInUp 0.4s ease;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title" data-i18n="auth.page.title">Choose Authentication</h1>
    <p class="subtitle" data-i18n="auth.page.description">Select your preferred login method to continue</p>

    <!-- Âä†ËΩΩ‰∏≠ÊïàÊûú -->
    <div id="loading-container" class="loading-container">
      <div class="loading-spinner"></div>
      <div class="loading-text" data-i18n="auth.loading.text">Checking access permissions...</div>
    </div>

    <!-- ‰∏≠ÂõΩIPÈôêÂà∂Ê∂àÊÅØ -->
    <div id="china-message" class="china-message hidden">
      <div class="china-message-icon">‚ö†Ô∏è</div>
      <div class="china-message-title" data-i18n="auth.china.restriction.title">Access Restricted</div>
      <div id="china-message-content" class="china-message-content">
        <!-- Âä®ÊÄÅÂä†ËΩΩÂêéÂè∞Ê∂àÊÅØ -->
      </div>
    </div>

    <!-- ÁôªÂΩïÊåâÈíÆÂÆπÂô® -->
    <div id="auth-buttons-container" class="auth-buttons-container hidden">
      <button id="feishu-btn" class="auth-button feishu-btn hidden" onclick="startFeishuAuth()">
      <img class="icon" src="https://res.ainirobot.com/orics/down/v2_k005_20250904_c768e6a4/feishu.ico" alt="Feishu" />
      <span data-i18n="auth.feishu.button">Feishu Login</span>
    </button>

    <button class="auth-button deepvlab-btn" onclick="startDeepvlabAuth()">
      <img class="icon" src="https://res.ainirobot.com/orics/down/v2_k005_20250904_52ad718e/deepv.ico" alt="DeepV" />
      <span data-i18n="auth.deepvlab.button">DeepVlab Unified Login</span>
    </button>

    <button id="cheetah-btn" class="auth-button cheetah-btn hidden" onclick="startCheetahAuth()">
      <img class="icon" src="https://www.cmcm.com/favicon.ico" alt="Cheetah" />
      <span data-i18n="auth.cheetah.button">Cheetah OA Login</span>
    </button>

    <button id="vipcard-btn" class="auth-button vipcard-btn" onclick="startVipCardAuth()">
      <span class="icon" style="font-size: 20px;">üé´</span>
      <span data-i18n="auth.vipcard.button">VIP Card Login</span>
    </button>

    <!-- ÁåéË±πOAÁôªÂΩïË°®Âçï -->
      <div id="cheetah-form" class="cheetah-form hidden">
        <h3 data-i18n="auth.cheetah.form.title">Cheetah OA Login</h3>
        <form id="cheetah-login-form" onsubmit="submitCheetahAuth(event)">
          <div class="form-group">
            <label for="cheetah-email" data-i18n="auth.cheetah.form.email">Email:</label>
            <input type="email" id="cheetah-email" name="email" required placeholder="user@cmcm.com" />
          </div>
          <div class="form-group">
            <label for="cheetah-password" data-i18n="auth.cheetah.form.password">Password:</label>
            <input type="password" id="cheetah-password" name="password" required />
          </div>
          <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="cancelCheetahAuth()" data-i18n="auth.cheetah.form.cancel">Cancel</button>
            <button type="submit" class="btn-primary" data-i18n="auth.cheetah.form.submit">Login</button>
          </div>
        </form>
      </div>

      <!-- VIPÂç°ÁôªÂΩïË°®Âçï -->
      <div id="vipcard-form" class="cheetah-form vipcard-form hidden">
        <h3 data-i18n="auth.vipcard.form.title">VIP Card Activation & Login</h3>
        <form id="vipcard-login-form" onsubmit="submitVipCardAuth(event)">
          <div class="form-group">
            <label for="vipcard-code" data-i18n="auth.vipcard.form.code">Redemption Code:</label>
            <input type="text" id="vipcard-code" name="code" required placeholder="VIP-XXXXXXXX" style="text-transform: uppercase;" />
            <div class="vipcard-hint" data-i18n="auth.vipcard.form.hint">Enter the code from your VIP card</div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="cancelVipCardAuth()" data-i18n="auth.vipcard.form.cancel">Cancel</button>
            <button type="submit" class="btn-primary" data-i18n="auth.vipcard.form.submit">Activate & Login</button>
          </div>
        </form>
      </div>
    </div>

    <div class="description" data-i18n="auth.page.instruction">
      Choose your authentication method and we will guide you through the secure login process
    </div>
  </div>

  <script>
    // ÂõΩÈôÖÂåñÁøªËØëÂØπË±°
    const translations = {
      en: {
        'auth.page.title': 'Choose Authentication',
        'auth.page.description': 'Select your preferred login method to continue',
        'auth.feishu.button': 'Feishu Login',
        'auth.deepvlab.button': 'DeepVlab Unified Login',
        'auth.cheetah.button': 'Cheetah OA Login',
        'auth.cheetah.form.title': 'Cheetah OA Login',
        'auth.cheetah.form.email': 'Email',
        'auth.cheetah.form.password': 'Password',
        'auth.cheetah.form.cancel': 'Cancel',
        'auth.cheetah.form.submit': 'Login',
        'auth.cheetah.form.submitting': 'Logging in...',
        'auth.page.instruction': 'Choose your authentication method and we will guide you through the secure login process',
        'auth.loading.text': 'Checking access permissions...',
        'auth.china.restriction.title': 'Access Restricted',
        'auth.feishu.start.error': 'Failed to start Feishu authentication, please try again',
        'auth.deepvlab.start.error': 'Failed to start DeepVlab authentication, please try again',
        'auth.cheetah.start.error': 'Failed to login with Cheetah OA, please check your credentials',
        'auth.message.success.title': 'Login Successful!',
        'auth.message.success.content': 'You have successfully logged in with Cheetah OA. You can now close this window and continue using DeepV Code.',
        'auth.message.success.button': 'Close',
        'auth.message.error.login.title': 'Login Failed',
        'auth.message.error.login.content': 'Cheetah OA authentication failed. Please check your credentials and try again.',
        'auth.message.error.login.button': 'Try Again',
        'auth.message.error.input.title': 'Input Required',
        'auth.message.error.input.content': 'Please fill in both email and password fields.',
        'auth.message.error.input.button': 'OK',
        'auth.message.error.connection.title': 'Connection Error',
        'auth.message.error.connection.content': 'Unable to connect to authentication server. Please check your network connection and try again.',
        'auth.message.error.connection.button': 'Retry',
        'auth.message.error.feishu.content': 'Unable to start Feishu authentication. Please check your network connection and try again.',
        'auth.message.error.deepvlab.content': 'Unable to start DeepVlab authentication. Please check your network connection and try again.',
        'auth.vipcard.button': 'VIP Card Login',
        'auth.vipcard.form.title': 'VIP Card Activation & Login',
        'auth.vipcard.form.code': 'Redemption Code',
        'auth.vipcard.form.hint': 'Enter the code from your VIP card',
        'auth.vipcard.form.cancel': 'Cancel',
        'auth.vipcard.form.submit': 'Activate & Login',
        'auth.vipcard.form.submitting': 'Processing...',
        'auth.vipcard.success.title': 'Activation Successful!',
        'auth.vipcard.success.content': 'Your VIP card has been activated and you are now logged in. You can close this window and continue using DeepV Code.',
        'auth.vipcard.error.empty': 'Please enter the redemption code.',
        'auth.vipcard.error.invalid': 'Invalid or expired redemption code. Please check and try again.'
      },
      zh: {
        'auth.page.title': 'ÈÄâÊã©ËÆ§ËØÅÊñπÂºè',
        'auth.page.description': 'ÈÄâÊã©ÊÇ®ÂÅèÂ•ΩÁöÑÁôªÂΩïÊñπÂºè‰ª•ÁªßÁª≠',
        'auth.feishu.button': 'È£û‰π¶ÁôªÂΩï',
        'auth.deepvlab.button': 'DeepVlabÁªü‰∏ÄÁôªÂΩï',
        'auth.cheetah.button': 'ÁåéË±πOAÁôªÂΩï',
        'auth.cheetah.form.title': 'ÁåéË±πOAÁôªÂΩï',
        'auth.cheetah.form.email': 'ÈÇÆÁÆ±',
        'auth.cheetah.form.password': 'ÂØÜÁ†Å',
        'auth.cheetah.form.cancel': 'ÂèñÊ∂à',
        'auth.cheetah.form.submit': 'ÁôªÂΩï',
        'auth.cheetah.form.submitting': 'ÁôªÂΩï‰∏≠...',
        'auth.page.instruction': 'ÈÄâÊã©ÊÇ®ÁöÑËÆ§ËØÅÊñπÂºèÔºåÊàë‰ª¨Â∞ÜÂºïÂØºÊÇ®ÂÆåÊàêÂÆâÂÖ®ÁöÑÁôªÂΩïÊµÅÁ®ã',
        'auth.loading.text': 'Ê≠£Âú®Ê£ÄÊü•ËÆøÈóÆÊùÉÈôê...',
        'auth.china.restriction.title': 'ËÆøÈóÆÂèóÈôê',
        'auth.feishu.start.error': 'È£û‰π¶ËÆ§ËØÅÂêØÂä®Â§±Ë¥•ÔºåËØ∑ÈáçËØï',
        'auth.deepvlab.start.error': 'DeepVlabËÆ§ËØÅÂêØÂä®Â§±Ë¥•ÔºåËØ∑ÈáçËØï',
        'auth.cheetah.start.error': 'ÁåéË±πOAÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÂá≠ÊçÆ',
        'auth.message.success.title': 'ÁôªÂΩïÊàêÂäüÔºÅ',
        'auth.message.success.content': 'ÊÇ®Â∑≤ÊàêÂäü‰ΩøÁî®ÁåéË±πOAÁôªÂΩï„ÄÇÁé∞Âú®ÂèØ‰ª•ÂÖ≥Èó≠Ê≠§Á™óÂè£Âπ∂ÁªßÁª≠‰ΩøÁî®DeepV Code„ÄÇ',
        'auth.message.success.button': 'ÂÖ≥Èó≠',
        'auth.message.error.login.title': 'ÁôªÂΩïÂ§±Ë¥•',
        'auth.message.error.login.content': 'ÁåéË±πOAËÆ§ËØÅÂ§±Ë¥•„ÄÇËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÂá≠ÊçÆÂπ∂ÈáçËØï„ÄÇ',
        'auth.message.error.login.button': 'ÈáçËØï',
        'auth.message.error.input.title': 'ÈúÄË¶ÅËæìÂÖ•',
        'auth.message.error.input.content': 'ËØ∑Â°´ÂÜôÈÇÆÁÆ±ÂíåÂØÜÁ†ÅÂ≠óÊÆµ„ÄÇ',
        'auth.message.error.input.button': 'Á°ÆÂÆö',
        'auth.message.error.connection.title': 'ËøûÊé•ÈîôËØØ',
        'auth.message.error.connection.content': 'Êó†Ê≥ïËøûÊé•Âà∞ËÆ§ËØÅÊúçÂä°Âô®„ÄÇËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÁΩëÁªúËøûÊé•Âπ∂ÈáçËØï„ÄÇ',
        'auth.message.error.connection.button': 'ÈáçËØï',
        'auth.message.error.feishu.content': 'Êó†Ê≥ïÂêØÂä®È£û‰π¶ËÆ§ËØÅ„ÄÇËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÁΩëÁªúËøûÊé•Âπ∂ÈáçËØï„ÄÇ',
        'auth.message.error.deepvlab.content': 'Êó†Ê≥ïÂêØÂä®DeepVlabËÆ§ËØÅ„ÄÇËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÁΩëÁªúËøûÊé•Âπ∂ÈáçËØï„ÄÇ',
        'auth.vipcard.button': 'VIPÂç°ÁôªÂΩï',
        'auth.vipcard.form.title': 'VIPÂç°ÊøÄÊ¥ª‰∏éÁôªÂΩï',
        'auth.vipcard.form.code': 'ÂÖëÊç¢Á†Å',
        'auth.vipcard.form.hint': 'ËØ∑ËæìÂÖ•VIPÂç°‰∏äÁöÑÂÖëÊç¢Á†Å',
        'auth.vipcard.form.cancel': 'ÂèñÊ∂à',
        'auth.vipcard.form.submit': 'ÊøÄÊ¥ªÂπ∂ÁôªÂΩï',
        'auth.vipcard.form.submitting': 'Â§ÑÁêÜ‰∏≠...',
        'auth.vipcard.success.title': 'ÊøÄÊ¥ªÊàêÂäüÔºÅ',
        'auth.vipcard.success.content': 'ÊÇ®ÁöÑVIPÂç°Â∑≤ÊøÄÊ¥ªÂπ∂ÂÆåÊàêÁôªÂΩï„ÄÇÁé∞Âú®ÂèØ‰ª•ÂÖ≥Èó≠Ê≠§Á™óÂè£Âπ∂ÁªßÁª≠‰ΩøÁî®DeepV Code„ÄÇ',
        'auth.vipcard.error.empty': 'ËØ∑ËæìÂÖ•ÂÖëÊç¢Á†Å„ÄÇ',
        'auth.vipcard.error.invalid': 'ÂÖëÊç¢Á†ÅÊó†ÊïàÊàñÂ∑≤ËøáÊúüÔºåËØ∑Ê£ÄÊü•ÂêéÈáçËØï„ÄÇ'
      }
    };

    // Ëé∑ÂèñÊµèËßàÂô®ËØ≠Ë®Ä
    function getBrowserLanguage() {
      const lang = navigator.language || navigator.userLanguage;
      return lang.startsWith('zh') ? 'zh' : 'en';
    }

    // ÁøªËØëÂáΩÊï∞
    function t(key) {
      const locale = getBrowserLanguage();
      return translations[locale][key] || translations.en[key] || key;
    }

    // ÂàùÂßãÂåñÈ°µÈù¢ÊñáÊú¨
    function initI18n() {
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        element.textContent = t(key);
        // ÂêåÊó∂Êõ¥Êñ∞titleÂ±ûÊÄßÔºàÂ¶ÇÊûúÊòØtitleÊ†áÁ≠æÔºâ
        if (element.tagName === 'TITLE') {
          document.title = t(key);
        }
      });
    }

    // Ê∂àÊÅØÊèêÁ§∫ÂáΩÊï∞
    function showMessage(type, title, content, buttonText = 'OK', options = {}) {
      const { closable = true } = options;

      // ÂàõÂª∫Ê∂àÊÅØË¶ÜÁõñÂ±Ç
      const overlay = document.createElement('div');
      overlay.className = 'message-overlay';

      // ÂàõÂª∫Ê∂àÊÅØÊ°Ü
      const messageBox = document.createElement('div');
      messageBox.className = 'message-box';

      // ÂõæÊ†á
      const icon = document.createElement('div');
      icon.className = `message-icon ${type}`;
      icon.innerHTML = type === 'success' ? '‚úì' : '‚úï';

      // Ê†áÈ¢ò
      const titleEl = document.createElement('div');
      titleEl.className = 'message-title';
      titleEl.textContent = title;

      // ÂÜÖÂÆπ
      const contentEl = document.createElement('div');
      contentEl.className = 'message-content';
      contentEl.textContent = content;

      // ÁªÑË£ÖÊ∂àÊÅØÊ°Ü
      messageBox.appendChild(icon);
      messageBox.appendChild(titleEl);
      messageBox.appendChild(contentEl);

      // ÊåâÈíÆÔºà‰ªÖÂú®ÂÖÅËÆ∏ÂÖ≥Èó≠Êó∂ÊòæÁ§∫Ôºâ
      if (closable) {
        const button = document.createElement('button');
        button.className = 'message-button';
        button.textContent = buttonText;
        button.onclick = () => {
          document.body.removeChild(overlay);
        };
        messageBox.appendChild(button);
      }

      overlay.appendChild(messageBox);

      // Ê∑ªÂä†Âà∞È°µÈù¢
      document.body.appendChild(overlay);

      // ÁÇπÂáªË¶ÜÁõñÂ±ÇÂÖ≥Èó≠Ôºà‰ªÖÂú®ÂÖÅËÆ∏ÂÖ≥Èó≠Êó∂Ôºâ
      if (closable) {
        overlay.onclick = (e) => {
          if (e.target === overlay) {
            document.body.removeChild(overlay);
          }
        };
      }
    }

    // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñi18nÂíåÊ£ÄÊü•ÁôªÂΩïÊùÉÈôê
    document.addEventListener('DOMContentLoaded', function() {
      initI18n();
      checkFeishuAllowed(); // Ëøô‰∏™ÂáΩÊï∞‰ºöËá™Âä®Ë∞ÉÁî®checkCheetahAllowed
    });

    function checkFeishuAllowed() {
      console.log('üîç ÂºÄÂßãÊ£ÄÊü•È£û‰π¶ÁôªÂΩïÊùÉÈôê...');
      console.log('üì° Ë∞ÉÁî®API: /api/backend/feishu-allowed');

      // Call the backend server to check if Feishu login is allowed
      fetch('/api/backend/feishu-allowed')
        .then(response => {
          console.log('üåê Êé•Âè£ÂìçÂ∫îÁä∂ÊÄÅ:', response.status);
          console.log('‚úÖ ËøõÂÖ•Á¨¨‰∏Ä‰∏™thenÂùó');
          return response.json();
        })
        .then(data => {
          console.log('‚úÖ ËøõÂÖ•Á¨¨‰∫å‰∏™thenÂùó - ÂºÄÂßãÂ§ÑÁêÜÊï∞ÊçÆ');
          console.log('üìã ÂêéÂè∞Êé•Âè£ËøîÂõûÂÆåÊï¥Êï∞ÊçÆ:', JSON.stringify(data, null, 2));

          // ÈöêËóèÂä†ËΩΩ‰∏≠ÊïàÊûú
          console.log('üîÑ ÂºÄÂßãÈöêËóèloadingÊïàÊûú...');
          const loadingContainer = document.getElementById('loading-container');
          console.log('üîç loadingÂÆπÂô®ÂÖÉÁ¥†:', loadingContainer);
          if (loadingContainer) {
            console.log('‚è≥ loadingÂÆπÂô®Â≠òÂú®ÔºåÊ∑ªÂä†hiddenÁ±ª');
            loadingContainer.classList.add('hidden');
            // ÂèåÈáç‰øùÈô©ÔºöÁõ¥Êé•ËÆæÁΩÆdisplayÊ†∑Âºè
            loadingContainer.style.display = 'none';
            console.log('‚úÖ loading hiddenÁ±ªÂ∑≤Ê∑ªÂä†ÔºådisplayËÆæÁΩÆ‰∏∫none');
            console.log('üé® loadingÂÆπÂô®ÂΩìÂâçclassName:', loadingContainer.className);
            console.log('üé® loadingÂÆπÂô®ÂΩìÂâçstyle.display:', loadingContainer.style.display);
          } else {
            console.error('‚ùå Êú™ÊâæÂà∞loadingÂÆπÂô®ÂÖÉÁ¥†!');
          }

          // Ê£ÄÊü•ÊòØÂê¶ÊòØ‰∏≠ÂõΩIP‰∏î‰∏çÂÖÅËÆ∏ÁôªÂΩï
          if (data.isChina && !data.feishuLoginAllowed && data.messages && data.messages.length > 0) {
            console.log('üá®üá≥ Ê£ÄÊµãÂà∞‰∏≠ÂõΩIP‰∏î‰∏çÂÖÅËÆ∏ÁôªÂΩïÔºåÊòæÁ§∫ÈôêÂà∂Ê∂àÊÅØ');

            // ÊòæÁ§∫‰∏≠ÂõΩIPÈôêÂà∂Ê∂àÊÅØ
            const chinaMessage = document.getElementById('china-message');
            const chinaMessageContent = document.getElementById('china-message-content');

            if (chinaMessage && chinaMessageContent) {
              // Â°´ÂÖÖÊ∂àÊÅØÂÜÖÂÆπ
              chinaMessageContent.innerHTML = data.messages.map(msg => `<p>${msg}</p>`).join('');

              // ÊòæÁ§∫Ê∂àÊÅØÊ°Ü
              chinaMessage.classList.remove('hidden');
              console.log('‚úÖ Â∑≤ÊòæÁ§∫‰∏≠ÂõΩIPÈôêÂà∂Ê∂àÊÅØ');
            }

            // ÁôªÂΩïÊåâÈíÆ‰øùÊåÅÈöêËóèÁä∂ÊÄÅÔºàÈªòËÆ§Â∞±ÊòØÈöêËóèÁöÑÔºâ
          } else {
            console.log('‚úÖ Èùû‰∏≠ÂõΩIPÔºåÊòæÁ§∫ÁôªÂΩïÈÄâÈ°π');

            // ÊòæÁ§∫ÁôªÂΩïÊåâÈíÆÂÆπÂô®
            const authButtonsContainer = document.getElementById('auth-buttons-container');
            if (authButtonsContainer) {
              authButtonsContainer.classList.remove('hidden');
              console.log('‚úÖ Â∑≤ÊòæÁ§∫ÁôªÂΩïÊåâÈíÆÂÆπÂô®');
            }

            // DeepVlabÁôªÂΩïÂßãÁªàÂèØÁî®ÔºàÊ≤°ÊúâhiddenÁ±ªÔºå‰ºöËá™Âä®ÊòæÁ§∫Ôºâ
            console.log('‚úÖ DeepVlabÁôªÂΩïÂßãÁªàÂèØÁî®');

            // Ê†πÊçÆÊùÉÈôêÊòæÁ§∫È£û‰π¶ÁôªÂΩïÊåâÈíÆ
            if (data.feishuLoginAllowed) {
              console.log('‚úÖ È£û‰π¶ÁôªÂΩïÂ∑≤ÂÖÅËÆ∏ÔºåÊòæÁ§∫È£û‰π¶ÁôªÂΩïÊåâÈíÆ');
              const feishuBtn = document.getElementById('feishu-btn');
              if (feishuBtn) {
                feishuBtn.classList.remove('hidden');
                console.log('‚úÖ È£û‰π¶ÁôªÂΩïÊåâÈíÆÂ∑≤ÊòæÁ§∫');
              }
            } else {
              console.log('üö´ È£û‰π¶ÁôªÂΩïË¢´Á¶ÅÁî®Ôºå‰øùÊåÅÈ£û‰π¶ÊåâÈíÆÈöêËóè');
            }

            // Ê£ÄÊü•ÁåéË±πOAÁôªÂΩïÊùÉÈôêÔºà‰ΩøÁî®Áõ∏ÂêåÁöÑÊï∞ÊçÆÔºâ
            checkCheetahAllowed(data);
          }
        })
        .catch(error => {
          console.error('‚ùå Ê£ÄÊü•È£û‰π¶ÁôªÂΩïÊùÉÈôêÂ§±Ë¥•:', error);
          console.log('üîÑ ËøõÂÖ•catchÂùó - APIË∞ÉÁî®Â§±Ë¥•');

          // ÈöêËóèÂä†ËΩΩ‰∏≠ÊïàÊûú
          console.log('üîÑ catchÂùó‰∏≠ÂºÄÂßãÈöêËóèloadingÊïàÊûú...');
          const loadingContainer = document.getElementById('loading-container');
          console.log('üîç catchÂùó‰∏≠loadingÂÆπÂô®ÂÖÉÁ¥†:', loadingContainer);
          if (loadingContainer) {
            console.log('‚è≥ catchÂùó‰∏≠loadingÂÆπÂô®Â≠òÂú®ÔºåÊ∑ªÂä†hiddenÁ±ª');
            loadingContainer.classList.add('hidden');
            // ÂèåÈáç‰øùÈô©ÔºöÁõ¥Êé•ËÆæÁΩÆdisplayÊ†∑Âºè
            loadingContainer.style.display = 'none';
            console.log('‚úÖ catchÂùó‰∏≠loading hiddenÁ±ªÂ∑≤Ê∑ªÂä†ÔºådisplayËÆæÁΩÆ‰∏∫none');
          } else {
            console.error('‚ùå catchÂùó‰∏≠Êú™ÊâæÂà∞loadingÂÆπÂô®ÂÖÉÁ¥†!');
          }

          // Âá∫ÈîôÊó∂ÊòæÁ§∫ÁôªÂΩïÊåâÈíÆÂÆπÂô®Ôºà‰øùÂÆàÂ§ÑÁêÜÔºâ
          const authButtonsContainer = document.getElementById('auth-buttons-container');
          if (authButtonsContainer) {
            authButtonsContainer.classList.remove('hidden');
          }

          console.log('üîÑ Â§±Ë¥•Êó∂ÊòæÁ§∫ÊâÄÊúâÁôªÂΩïÈÄâÈ°π');
        });
    }

    function checkCheetahAllowed(data) {
      console.log('üîç ÂºÄÂßãÊ£ÄÊü•ÁåéË±πOAÁôªÂΩïÊùÉÈôê...');

      // ‰ΩøÁî®‰∏éÈ£û‰π¶Áõ∏ÂêåÁöÑÊùÉÈôêÊ£ÄÊü•ÈÄªËæë
      if (data && !data.isChina && data.feishuLoginAllowed) {
        console.log('‚úÖ ÁåéË±πOAÁôªÂΩïÂ∑≤ÂÖÅËÆ∏ÔºåÊòæÁ§∫ÁôªÂΩïÊåâÈíÆ');
        // ÊòæÁ§∫ÁåéË±πOAÁôªÂΩïÊåâÈíÆ
        const cheetahBtn = document.getElementById('cheetah-btn');
        if (cheetahBtn) {
          cheetahBtn.classList.remove('hidden');
          console.log('‚úÖ ÁåéË±πOAÁôªÂΩïÊåâÈíÆÂ∑≤ÊòæÁ§∫');
        } else {
          console.warn('‚ö†Ô∏è Êú™ÊâæÂà∞ÁåéË±πOAÁôªÂΩïÊåâÈíÆÂÖÉÁ¥†');
        }
      } else {
        console.log('üö´ ÁåéË±πOAÁôªÂΩïË¢´Á¶ÅÁî®Ôºå‰øùÊåÅÊåâÈíÆÈöêËóè');
      }
    }

    function startFeishuAuth() {
      console.log('ÂêØÂä®È£û‰π¶ËÆ§ËØÅ...');
      // ËøôÈáå‰ºöË∞ÉÁî®È£û‰π¶ËÆ§ËØÅÈÄªËæë
      fetch('/start-feishu-auth', { method: 'POST' })
        .then(response => response.json())
        .then(data => {
          if (data.authUrl) {
            // ‰øÆÂ§çÊñπÊ°àÔºöÁõ¥Êé•ÊõøÊç¢ÂΩìÂâçÈ°µÈù¢Âà∞ËÆ§ËØÅURLÔºåÈÅøÂÖç‰∫ßÁîüÈ¢ùÂ§ñÁöÑÁ©∫ÁôΩÈ°µÈù¢
            // ËøôÊ†∑ËÆ§ËØÅÂÆåÊàêÂêéÂè™ÈúÄË¶ÅÂÖ≥Èó≠‰∏Ä‰∏™È°µÈù¢Ôºå‰∏ç‰ºöÁïô‰∏ãÁ©∫ÁôΩÁöÑ‰∏≠Èó¥È°µ
            window.location.replace(data.authUrl);
          }
        })
        .catch(error => {
          console.error('È£û‰π¶ËÆ§ËØÅÂêØÂä®Â§±Ë¥•:', error);
          showMessage('error', t('auth.message.error.connection.title'), t('auth.message.error.feishu.content'), t('auth.message.error.connection.button'));
        });
    }

    function startDeepvlabAuth() {
      console.log('ÂêØÂä®DeepVlabËÆ§ËØÅ...');
      // ËøôÈáå‰ºöË∞ÉÁî®DeepVlabËÆ§ËØÅÈÄªËæë
      fetch('/start-deepvlab-auth', { method: 'POST' })
        .then(response => response.json())
        .then(data => {
          if (data.authUrl) {
            // ‰øÆÂ§çÊñπÊ°àÔºöÁõ¥Êé•ÊõøÊç¢ÂΩìÂâçÈ°µÈù¢Âà∞ËÆ§ËØÅURLÔºåÈÅøÂÖç‰∫ßÁîüÈ¢ùÂ§ñÁöÑÁ©∫ÁôΩÈ°µÈù¢
            // ËøôÊ†∑ËÆ§ËØÅÂÆåÊàêÂêéÂè™ÈúÄË¶ÅÂÖ≥Èó≠‰∏Ä‰∏™È°µÈù¢Ôºå‰∏ç‰ºöÁïô‰∏ãÁ©∫ÁôΩÁöÑ‰∏≠Èó¥È°µ
            window.location.replace(data.authUrl);
          }
        })
        .catch(error => {
          console.error('DeepVlabËÆ§ËØÅÂêØÂä®Â§±Ë¥•:', error);
          showMessage('error', t('auth.message.error.connection.title'), t('auth.message.error.deepvlab.content'), t('auth.message.error.connection.button'));
        });
    }

    function startCheetahAuth() {
      console.log('ÊòæÁ§∫ÁåéË±πOAÁôªÂΩïË°®Âçï...');
      // ÈöêËóèÊâÄÊúâËÆ§ËØÅÊåâÈíÆ
      const buttons = document.querySelectorAll('.auth-button');
      buttons.forEach(btn => btn.style.display = 'none');

      // ÊòæÁ§∫ÁåéË±πOAË°®Âçï
      const form = document.getElementById('cheetah-form');
      if (form) {
        form.classList.remove('hidden');
      }
    }

    function cancelCheetahAuth() {
      console.log('ÂèñÊ∂àÁåéË±πOAÁôªÂΩï...');
      // ÈöêËóèË°®Âçï
      const form = document.getElementById('cheetah-form');
      if (form) {
        form.classList.add('hidden');
      }

      // ÊòæÁ§∫ÊâÄÊúâËÆ§ËØÅÊåâÈíÆ
      const buttons = document.querySelectorAll('.auth-button');
      buttons.forEach(btn => btn.style.display = 'flex');
    }

    function submitCheetahAuth(event) {
      event.preventDefault();
      console.log('Êèê‰∫§ÁåéË±πOAÁôªÂΩï...');

      const email = document.getElementById('cheetah-email').value;
      const password = document.getElementById('cheetah-password').value;

      if (!email || !password) {
        showMessage('error', t('auth.message.error.input.title'), t('auth.message.error.input.content'), t('auth.message.error.input.button'));
        return;
      }

      // Á¶ÅÁî®Êèê‰∫§ÊåâÈíÆ
      const submitBtn = event.target.querySelector('button[type="submit"]');
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = t('auth.cheetah.form.submitting');
      }

      fetch('/start-cheetah-auth', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ email, password })
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // ÁôªÂΩïÊàêÂäüÔºåÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØÔºà‰∏çÂÖÅËÆ∏ÂÖ≥Èó≠Ôºâ
            showMessage('success', t('auth.message.success.title'), t('auth.message.success.content'), t('auth.message.success.button'), { closable: false });
            // ÈöêËóèË°®ÂçïÔºåÊòæÁ§∫ÊåâÈíÆ
            cancelCheetahAuth();
          } else {
            showMessage('error', t('auth.message.error.login.title'), data.message || t('auth.message.error.login.content'), t('auth.message.error.login.button'));
          }
        })
        .catch(error => {
          console.error('ÁåéË±πOAÁôªÂΩïÂ§±Ë¥•:', error);
          showMessage('error', t('auth.message.error.connection.title'), t('auth.message.error.connection.content'), t('auth.message.error.connection.button'));
        })
        .finally(() => {
          // ÊÅ¢Â§çÊèê‰∫§ÊåâÈíÆ
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = t('auth.cheetah.form.submit');
          }
        });
    }

    function startVipCardAuth() {
      console.log('ÊòæÁ§∫VIPÂç°ÁôªÂΩïË°®Âçï...');
      // ÈöêËóèÊâÄÊúâËÆ§ËØÅÊåâÈíÆ
      const buttons = document.querySelectorAll('.auth-button');
      buttons.forEach(btn => btn.style.display = 'none');

      // ÊòæÁ§∫VIPÂç°Ë°®Âçï
      const form = document.getElementById('vipcard-form');
      if (form) {
        form.classList.remove('hidden');
        // ËÅöÁÑ¶Âà∞ËæìÂÖ•Ê°Ü
        const codeInput = document.getElementById('vipcard-code');
        if (codeInput) {
          codeInput.focus();
        }
      }
    }

    function cancelVipCardAuth() {
      console.log('ÂèñÊ∂àVIPÂç°ÁôªÂΩï...');
      // ÈöêËóèË°®Âçï
      const form = document.getElementById('vipcard-form');
      if (form) {
        form.classList.add('hidden');
      }

      // Ê∏ÖÁ©∫ËæìÂÖ•
      const codeInput = document.getElementById('vipcard-code');
      if (codeInput) {
        codeInput.value = '';
      }

      // ÊòæÁ§∫ÊâÄÊúâËÆ§ËØÅÊåâÈíÆ
      const buttons = document.querySelectorAll('.auth-button');
      buttons.forEach(btn => btn.style.display = 'flex');
    }

    function submitVipCardAuth(event) {
      event.preventDefault();
      console.log('Êèê‰∫§VIPÂç°ÁôªÂΩï...');

      const codeInput = document.getElementById('vipcard-code');
      const code = codeInput ? codeInput.value.trim().toUpperCase() : '';

      if (!code) {
        showMessage('error', t('auth.message.error.input.title'), t('auth.vipcard.error.empty'), t('auth.message.error.input.button'));
        return;
      }

      // Á¶ÅÁî®Êèê‰∫§ÊåâÈíÆ
      const submitBtn = event.target.querySelector('button[type="submit"]');
      const cancelBtn = event.target.querySelector('button[type="button"]');
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = t('auth.vipcard.form.submitting');
      }
      if (cancelBtn) {
        cancelBtn.disabled = true;
      }

      fetch('/start-vipcard-auth', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ code })
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // ÁôªÂΩïÊàêÂäüÔºåÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØÔºà‰∏çÂÖÅËÆ∏ÂÖ≥Èó≠Ôºâ
            showMessage('success', t('auth.vipcard.success.title'), t('auth.vipcard.success.content'), t('auth.message.success.button'), { closable: false });
            // ÈöêËóèË°®ÂçïÔºåÊòæÁ§∫ÊåâÈíÆ
            cancelVipCardAuth();
          } else {
            showMessage('error', t('auth.message.error.login.title'), data.message || t('auth.vipcard.error.invalid'), t('auth.message.error.login.button'));
          }
        })
        .catch(error => {
          console.error('VIPÂç°ÁôªÂΩïÂ§±Ë¥•:', error);
          showMessage('error', t('auth.message.error.connection.title'), t('auth.message.error.connection.content'), t('auth.message.error.connection.button'));
        })
        .finally(() => {
          // ÊÅ¢Â§çÊèê‰∫§ÊåâÈíÆ
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = t('auth.vipcard.form.submit');
          }
          if (cancelBtn) {
            cancelBtn.disabled = false;
          }
        });
    }
  </script>
</body>
</html>