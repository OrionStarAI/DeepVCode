import fs from 'fs';

export interface RefinePromptOptions {
  tone: string;
  level: string;
  lang: string;
  max?: number;
  keepCode: boolean;
  keepFormat: boolean;
  noEmoji: boolean;
  glossary?: string;
  rules: string[];
}

/**
 * æ„å»ºæ¶¦è‰²æç¤ºè¯ (ç ”å‘å‹å¥½ç‰ˆ)
 */
export function buildEngineeringRefinePrompt(text: string, options: RefinePromptOptions): string {
  const parts: string[] = [];

  // 1. Role definition
  parts.push('# è§’è‰²');
  parts.push('');
  parts.push('ä½ æ˜¯å·¥ç¨‹å†™ä½œç²¾ä¿®å™¨. ä½ çš„ä»»åŠ¡æ˜¯åœ¨ä¸æ”¹å˜æŠ€æœ¯å«ä¹‰çš„å‰æä¸‹, è®©æ–‡æœ¬æ›´æ¸…æ™°, ç®€æ´, ä¸“ä¸š, é€‚åˆå·¥ç¨‹å¸ˆé˜…è¯»å’Œåä½œ(ä»£ç è¯„å®¡, Issue, æ–‡æ¡£, æäº¤è¯´æ˜ç­‰).');
  parts.push('');

  // 2. Hard constraints
  parts.push('# ç¡¬æ€§çº¦æŸ (å¿…é¡»éµå®ˆ)');
  parts.push('');

  if (options.keepCode) {
    parts.push('**ä¸æ”¹åŠ¨ä»£ç ä¸å‘½ä»¤**: ä¿ç•™ä»£ç å—, è¡Œå†… code, shell/SQL/è·¯å¾„/ç«¯å£/é…ç½®é”®, æ ‡å¿—ä½(å¦‚ --flag), ç‰ˆæœ¬å·, IP/URL, ç¯å¢ƒå˜é‡, å ä½ç¬¦(å¦‚ VAR), æ­£åˆ™, JSON/YAML å­—æ®µå. ç»å¯¹ä¸ä¿®æ”¹åå¼•å·å†…æ–‡æœ¬å’Œä¸‰å¼•å·ä»£ç å—.');
    parts.push('');
  }

  if (options.keepFormat) {
    parts.push('**ç»“æ„ä¿ç•™**: ä¿ç•™ Markdown æ ‡é¢˜å±‚çº§, åˆ—è¡¨, è¡¨æ ¼, è„šæ³¨ç¼–å·, å¼•ç”¨å—ä¸é“¾æ¥æ–‡æœ¬, ä»…åœ¨å¿…è¦æ—¶å¾®è°ƒæ ‡ç‚¹å’Œç©ºæ ¼. ä¸æ”¹å˜è¡¨æ ¼åˆ—æ•°ä¸å¯¹é½, åˆ—è¡¨ç¼–å·é¡ºåº.');
    parts.push('');
  }

  parts.push('**ä¿æŒæœ¯è¯­ä¸å¤§å°å†™**: ä¿ç•™æ¡†æ¶/åº“/API åç§° (React, TypeScript, Node.js, HTTP/2, POSIX ç­‰) çš„æ­£ç¡®å¤§å°å†™å’Œæ‹¼å†™.');
  parts.push('');
  parts.push('**ä¸å‘æ˜äº‹å®**: ä¸æ·»åŠ ä¸å­˜åœ¨çš„å‚æ•°, é…ç½®, ä¾èµ–æˆ–æŠ€æœ¯ç»†èŠ‚.');
  parts.push('');

  if (options.noEmoji) {
    parts.push('**ç¦æ­¢ Emoji**: è¾“å‡ºä¸­ä¸ä½¿ç”¨ä»»ä½•è¡¨æƒ…ç¬¦å·.');
    parts.push('');
  }

  // Language settings
  if (options.lang === 'auto') {
    parts.push('**è¯­è¨€**: è‡ªåŠ¨æ£€æµ‹è¾“å…¥è¯­è¨€å¹¶ä½¿ç”¨ç›¸åŒè¯­è¨€è¾“å‡º, å—ä¼—ä¸ºå·¥ç¨‹å¸ˆ.');
  } else {
    parts.push('**è¯­è¨€**: ä½¿ç”¨ ' + options.lang + ' è¾“å‡º, ä¿ç•™å¿…è¦çš„è‹±æ–‡æŠ€æœ¯æœ¯è¯­.');
  }
  parts.push('');

  // 3. Tone and Level mapping
  parts.push('# æ¶¦è‰²ç­–ç•¥');
  parts.push('');

  // Tone instructions
  const toneMap: Record<string, string> = {
    neutral: '**è¯­æ°” - ä¸“ä¸šå®¢è§‚**\n- æœ€é€šç”¨çš„å·¥ç¨‹å¸ˆè¯­æ°”\n- æ¸…æ™°è¡¨è¾¾æŠ€æœ¯è¦ç‚¹\n- é¿å…ä¸»è§‚æƒ…ç»ªè¯',
    friendly: '**è¯­æ°” - è½»åº¦å‹å¥½**\n- é€‚åˆå†…éƒ¨å›¢é˜Ÿæ²Ÿé€š\n- ä¿æŒä¸“ä¸šä½†ä¸è¿‡åˆ†æ­£å¼\n- å¯ä½¿ç”¨ æˆ‘ä»¬ å»ºè®® ç­‰åä½œæ€§è¯æ±‡',
    formal: '**è¯­æ°” - æ­£å¼ä¹¦é¢**\n- é€‚åˆå¯¹å¤–æ–‡æ¡£ å…¬å‘Š æŠ€æœ¯è§„èŒƒ\n- ä½¿ç”¨å®Œæ•´å¥å¼\n- é¿å…å£è¯­åŒ–è¡¨è¾¾',
    concise: '**è¯­æ°” - ç²¾ç®€ç›´è¾¾**\n- æœ€çŸ­è·¯å¾„è¡¨è¾¾\n- åˆ é™¤æ‰€æœ‰å†—ä½™\n- é€‚åˆæäº¤è¯´æ˜ Issue æ ‡é¢˜',
    marketing: '**è¯­æ°” - è½»è¥é”€å‘**\n- çªå‡ºä»·å€¼å’Œäº®ç‚¹\n- ä¿æŒæŠ€æœ¯å‡†ç¡®æ€§\n- å¯ä½¿ç”¨æœ‰é™çš„å½¢å®¹è¯',
    tech: '**è¯­æ°” - æŠ€æœ¯çº¯ç²¹**\n- ä¿ç•™æ‰€æœ‰æŠ€æœ¯æœ¯è¯­å’Œè¡Œè¯\n- æœ€å°‘ä¿®è¾\n- é€‚åˆ API æ–‡æ¡£ æŠ€æœ¯ç»†èŠ‚',
  };
  parts.push(toneMap[options.tone] || toneMap.neutral);
  parts.push('');

  // Level instructions
  const levelMap: Record<string, string> = {
    light: '**å¼ºåº¦ - è½»å¾®è°ƒæ•´**\n- åªä¿®æ­£æ‹¼å†™é”™è¯¯ æ ‡ç‚¹ è¯­åº\n- ä¸é‡å†™å¥å­ç»“æ„\n- å‹ç¼©å¹…åº¦ <= 20%\n- è‹¥æ£€æµ‹åˆ°ä»£ç /å‘½ä»¤å¯†åº¦é«˜ è‡ªåŠ¨é‡‡ç”¨æ­¤çº§åˆ«',
    medium: '**å¼ºåº¦ - é€‚åº¦æ”¹å†™**\n- é‡æ’å¥å­ä»¥æå‡é€»è¾‘æ¸…æ™°åº¦\n- æ®µå†…å°å¹…è°ƒæ•´\n- æ¶ˆé™¤æ˜æ˜¾å†—ä½™\n- å°†å‰ææ¡ä»¶å‰ç½®\n- **é€‚åº¦å»¶å±•**: åœ¨ç”¨æˆ·æ„å›¾æ˜ç¡®ä½†è¡¨è¿°è¿‡ç®€æ—¶, è¡¥å……å¿…è¦çš„ä¸Šä¸‹æ–‡æˆ–æ‰§è¡Œç»†èŠ‚ (å¦‚: ä» "çœ‹çœ‹ç»Ÿè®¡" å»¶å±•ä¸º "åˆ†æç»Ÿè®¡æ•°æ®å¹¶æ€»ç»“å…³é”®æŒ‡æ ‡")',
    deep: '**å¼ºåº¦ - æ·±åº¦é‡æ„**\n- åœ¨ä¸æ”¹äº‹å®å‰æä¸‹å¯é‡æ„æ®µè½\n- çªå‡ºå‰æ/é™åˆ¶/æ­¥éª¤é¡ºåº\n- ä¼˜åŒ–ä¿¡æ¯ç»„ç»‡\n- æ˜¾è‘—æå‡å¯è¯»æ€§\n- **æ·±åº¦å»¶å±•**: ç†è§£ç”¨æˆ·æ ¸å¿ƒè¯‰æ±‚, å°†æ¨¡ç³Šéœ€æ±‚è½¬åŒ–ä¸ºå…·ä½“å¯æ‰§è¡Œæè¿°, è¡¥å……åˆç†çš„ä¸Šä¸‹æ–‡å’Œæ“ä½œç»†èŠ‚\n- **ç²¾å‡†åŒ–**: ä¸º AI æ¨¡å‹æä¾›æ›´å¤šç²¾å‡†è¡¨è¿°, å¦‚è¾“å…¥æ ¼å¼/è¾“å‡ºè¦æ±‚/å¤„ç†é‡ç‚¹ç­‰',
  };
  parts.push(levelMap[options.level] || levelMap.medium);
  parts.push('');

  // 4. Style goals
  parts.push('# é£æ ¼ç›®æ ‡');
  parts.push('');
  parts.push('- **æ¸…æ™°**: ä¸€å¥ä¸€æ„, ä¼˜å…ˆä¸»åŠ¨è¯­æ€, æŠ€æœ¯åè¯å‡†ç¡®, é€»è¾‘é¡ºåº: èƒŒæ™¯->é—®é¢˜->æ–¹æ¡ˆ->é™åˆ¶');
  parts.push('- **ç®€æ´**: åˆ é™¤å†—ä½™å£å¤´è¯­ (å…¶å® å°±æ˜¯ ç„¶å), é¿å…é‡å¤, å»é™¤æ„Ÿå¹å·ä¸å¤¸å¼ å½¢å®¹');
  parts.push('- **å¯æ‰§è¡Œ**: å¯¹éœ€è¦æ“ä½œçš„å¥å­, ä¿ç•™å‘½ä»¤/è·¯å¾„/å‚æ•°, ä¸æ”¹ç»“æ„');
  parts.push('- **å¯å®¡é˜…**: å…³é”®æ¡ä»¶ä¸é™åˆ¶æ”¹å†™ä¸ºæ˜¾å¼å‰ç½® (å¦‚: å‰æ Node.js >= 20)');
  parts.push('');

  // 5. Length strategy
  if (options.max) {
    parts.push('# é•¿åº¦é™åˆ¶');
    parts.push('');
    parts.push('æœ€å¤§è¾“å‡ºé•¿åº¦: ' + options.max + ' å­—ç¬¦. åœ¨ä¸æŸå¤±å…³é”®ä¿¡æ¯çš„å‰æä¸‹è¿›è¡Œè¯­ä¹‰å‹ç¼©.');
    parts.push('');
  } else {
    parts.push('# é•¿åº¦ç­–ç•¥');
    parts.push('');
    parts.push('åœ¨ä¸æŸå¤±ä¿¡æ¯çš„å‰æä¸‹å°½å¯èƒ½ç®€çŸ­. å»é™¤å†—ä½™ å£æ°´è¯.');
    parts.push('');
  }

  // 6. Glossary
  if (options.glossary) {
    try {
      const glossaryContent = fs.readFileSync(options.glossary, 'utf-8');
      const glossary = JSON.parse(glossaryContent);
      parts.push('# æœ¯è¯­è¡¨ (ä¸¥æ ¼éµå®ˆ)');
      parts.push('');
      parts.push('ä»¥ä¸‹æœ¯è¯­å¿…é¡»æŒ‰ç…§æŒ‡å®šæ–¹å¼ç»Ÿä¸€ (åŒºåˆ†å¤§å°å†™):');
      parts.push('');
      for (const [term, replacement] of Object.entries(glossary)) {
        parts.push('- ' + term + ' -> ' + replacement);
      }
      parts.push('');
    } catch (error) {
      // Skip if glossary fails to load
    }
  }

  // 7. Custom rules
  if (options.rules.length > 0) {
    parts.push('# è‡ªå®šä¹‰è§„åˆ™');
    parts.push('');
    parts.push('é™¤ä¸Šè¿°çº¦æŸå¤–, è¿˜éœ€éµå®ˆä»¥ä¸‹è§„åˆ™:');
    parts.push('');
    options.rules.forEach((rule, index) => {
      parts.push((index + 1) + '. ' + rule);
    });
    parts.push('');
  }

  // 8. Typo correction
  parts.push('# é”™åˆ«å­—å¤„ç†');
  parts.push('');
  parts.push('åœ¨æ¶¦è‰²å‰å…ˆåšè½»é‡è¯­ä¹‰çº å (ä½†ä¸æ”¹å˜æŠ€æœ¯å«ä¹‰):');
  parts.push('- è‡ªåŠ¨ä¿®æ­£æ˜æ˜¾æ‹¼å†™é”™è¯¯ (å¦‚ Nodej -> Node.js)');
  parts.push('- æ¶ˆè§£æŒ‡ä»£ä¸æ¸…çš„ å®ƒ/è¿™ä¸ª (æ”¹ä¸ºæ˜ç¡®ä¸»è¯­)');
  parts.push('- å°†å£è¯­åŒ–éœ€æ±‚æ”¹ä¸ºå·¥ç¨‹å¸ˆå¯è¯»æè¿°');
  parts.push('- è‹¥æœ¯è¯­ä¸ç¡®å®š ä¿æŒåŸæ ·');
  parts.push('');

  // 9. Intent expansion strategy (ç®€åŒ–åˆå¹¶ç‰ˆ)
  parts.push('# å»¶å±•ç­–ç•¥');
  parts.push('');
  parts.push('**å»¶å±•å¼ºåº¦ (æ ¹æ® level å‚æ•°):**');
  parts.push('- **light**: åªçº é”™, ä¸å»¶å±•');
  parts.push('- **medium**: è¡¥å……å…³é”®ä¿¡æ¯ - What(å¯¹è±¡) + Why(ç›®çš„) + How(æ–¹æ³•)');
  parts.push('- **deep**: å®Œæ•´æ–¹æ¡ˆ - é¢å¤–è¡¥å…… When/Where/Who + æ‰§è¡Œç»†èŠ‚ + éªŒè¯æ ‡å‡†');
  parts.push('');
  parts.push('**å¸¸è§æ„å›¾ç±»å‹çš„å»¶å±•æ–¹å‘:**');
  parts.push('- **æŸ¥è¯¢å‹** ("çœ‹çœ‹", "æ˜¾ç¤º") â†’ è¡¥å……: æŸ¥è¯¢èŒƒå›´/è¾“å‡ºæ ¼å¼/ç­›é€‰æ¡ä»¶/æ—¶é—´èŒƒå›´');
  parts.push('- **æ‰§è¡Œå‹** ("ä¼˜åŒ–", "ä¿®æ”¹") â†’ è¡¥å……: æ‰§è¡Œå¯¹è±¡/ç›®æ ‡æ ‡å‡†/çº¦æŸæ¡ä»¶/éªŒè¯æ–¹æ³•');
  parts.push('- **è¯Šæ–­å‹** ("åˆ†æ", "æ£€æŸ¥") â†’ è¡¥å……: åˆ†æå¯¹è±¡/åˆ†æç»´åº¦/è¾“å‡ºå½¢å¼/ä¸¥é‡ç­‰çº§');
  parts.push('- **å»ºè®®å‹** ("æ€ä¹ˆåš") â†’ è¡¥å……: åœºæ™¯ä¸Šä¸‹æ–‡/å¯é€‰æ–¹æ¡ˆ/è¯„ä¼°æ ‡å‡†');
  parts.push('');
  parts.push('**å»¶å±•æ ¸å¿ƒè¦æ±‚:**');
  parts.push('1. ç†è§£æ ¸å¿ƒæ„å›¾, è¯†åˆ«ç”¨æˆ·çœŸæ­£æƒ³åšä»€ä¹ˆ');
  parts.push('2. è¡¥å……æ‰§è¡Œç»†èŠ‚: è¾“å…¥è¾“å‡ºæ ¼å¼/å¤„ç†é‡ç‚¹/çº¦æŸæ¡ä»¶');
  parts.push('3. ä¿æŒå‡†ç¡®æ€§: åŸºäºåˆç†æ¨æ–­, ä¸å‘æ˜äº‹å®, ä¸æ·»åŠ åŸæ–‡æœªæåŠçš„å·¥å…·/æ¡†æ¶');
  parts.push('');

  // 10. Content type detection
  parts.push('# å†…å®¹ç±»å‹è¯†åˆ«');
  parts.push('');
  parts.push('æ ¹æ®è¾“å…¥ç‰¹å¾è‡ªåŠ¨åº”ç”¨å¯¹åº”å¾®ç­–ç•¥:');
  parts.push('- **å‘½ä»¤/é…ç½®**: åªæ”¹å™è¿°æ–‡å­—, å‘½ä»¤/é”®/å€¼/æ ‡å¿—ä½ä¸€å¾‹ä¸åŠ¨');
  parts.push('- **æäº¤ä¿¡æ¯/PRæ ‡é¢˜**: ç»“æ„ä¸º scope: action - impact, å»é™¤æ„Ÿå¹å·');
  parts.push('- **Issueæè¿°**: æŒ‰ èƒŒæ™¯/ç°è±¡/æœŸæœ›/å¤ç°æ­¥éª¤/ç¯å¢ƒ é¡ºåºç†é¡º');
  parts.push('- **æŠ€æœ¯æ–‡æ¡£**: æ¡ç†æ¸…æ™° å‰ææ¡ä»¶å‰ç½®');
  parts.push('- **ä»£ç æ³¨é‡Š**: ä¿æŒç®€æ´ é¿å…ä¸»è§‚è¯­æ°”');
  parts.push('');

  // 10. Output rules
  parts.push('# è¾“å‡ºæ ¼å¼è§„åˆ™');
  parts.push('');
  parts.push('1. ä¸­è‹±æ–‡æ··æ’æ—¶, è‹±æ–‡å•è¯ä¸ä¸­æ–‡ä¹‹é—´åŠ å…¥åˆç†ç©ºæ ¼ (å¦‚ åœ¨ Node.js ç¯å¢ƒä¸­)');
  parts.push('2. æ ‡é¢˜å¥é¦–ä¸åŠ å¥å·, åˆ—è¡¨é¡¹æœ«å°¾ç»Ÿä¸€æ ‡ç‚¹');
  parts.push('3. åˆ—è¡¨ä¸­çš„æ­¥éª¤ä½¿ç”¨åŠ¨è¯å¼€å¤´ (å¦‚ å®‰è£…/é…ç½®/éªŒè¯)');
  parts.push('4. ä¿ç•™åŸæœ‰çš„å¼•ç”¨å— ä»£ç å— é“¾æ¥ä¸å›¾ç‰‡, ä¸æ”¹é“¾æ¥ç›®æ ‡');
  parts.push('5. åªç»™ä¸€ä¸ªç‰ˆæœ¬çš„ç»“æœ, ä¸æä¾›å¤šä¸ªé€‰é¡¹');
  parts.push('');

  // 11. Anti-patterns (when NOT to expand)
  parts.push('# å»¶å±•ç¦åŒº');
  parts.push('');
  parts.push('**ç¦æ­¢å»¶å±•çš„æƒ…å†µ:**');
  parts.push('1. ç”¨æˆ·å·²ç»å¾ˆå…·ä½“ - ä¸ç”»è›‡æ·»è¶³');
  parts.push('2. å»¶å±•ä¼šæ”¹å˜åŸæ„ - "å¿«é€Ÿçœ‹çœ‹"ä¸åº”å»¶å±•ä¸º"æ·±åº¦åˆ†æ"');
  parts.push('3. æŠ€æœ¯ç»†èŠ‚ä¸ç¡®å®š - ä¸æŒ‡å®šå…·ä½“æŠ€æœ¯æ ˆ, ä½¿ç”¨é€šç”¨æè¿°');
  parts.push('4. æµ‹è¯•æ€§è¾“å…¥ - "è¯•è¯•çœ‹", "hello" ç­‰ä¿æŒåŸæ ·');
  parts.push('');

  // 12. Executability quality checklist (ç²¾ç®€ç‰ˆ)
  parts.push('# å¯æ‰§è¡Œæ€§æ£€æŸ¥');
  parts.push('');
  parts.push('**å»¶å±•åé¿å…æ¨¡ç³Šè¡¨è¾¾:**');
  parts.push('- âŒ é¿å…: "ç›¸å…³çš„/é€‚å½“çš„/åˆç†çš„/è¿™ä¸ª/é‚£ä¸ª"');
  parts.push('- âœ… æ˜ç¡®: å…·ä½“å¯¹è±¡/æ ¼å¼/æ ‡å‡†/èŒƒå›´/é¡ºåº');
  parts.push('');
  parts.push('**å»¶å±•åå¿…é¡»æ¸…æ™°:**');
  parts.push('- è¾“å…¥æ˜¯ä»€ä¹ˆ? (æ˜ç¡®å¯¹è±¡)');
  parts.push('- è¾“å‡ºæ˜¯ä»€ä¹ˆ? (æ˜ç¡®æ ¼å¼)');
  parts.push('- å¦‚ä½•éªŒè¯? (å¯éªŒè¯æ ‡å‡†)');
  parts.push('- è¾¹ç•Œæ¡ä»¶? (èŒƒå›´/å¼‚å¸¸/å‰æ)');
  parts.push('');



  // 12. Input text
  parts.push('---');
  parts.push('');
  parts.push('# å¾…æ¶¦è‰²æ–‡æœ¬');
  parts.push('');

  // æ£€æµ‹æ–‡æœ¬é•¿åº¦ï¼Œå¦‚æœæ˜¯é•¿æ–‡æœ¬ï¼Œæ·»åŠ ç‰¹åˆ«æé†’
  const textLength = text.length;
  const isLongText = textLength > 500; // è¶…è¿‡ 500 å­—ç¬¦è§†ä¸ºé•¿æ–‡æœ¬

  if (isLongText) {
    parts.push('âš ï¸ **é•¿æ–‡æœ¬å¤„ç†ç‰¹åˆ«æé†’** âš ï¸');
    parts.push('');
    parts.push('ä¸‹æ–¹æ˜¯ä¸€æ®µè¾ƒé•¿çš„æ–‡æœ¬ (' + textLength + ' å­—ç¬¦)ã€‚');
    parts.push('');
    parts.push('**è¯·åŠ¡å¿…:**');
    parts.push('1. **å®Œæ•´é˜…è¯»** - ä»å¤´åˆ°å°¾é˜…è¯»æ‰€æœ‰å†…å®¹ï¼Œä¸è¦é—æ¼');
    parts.push('2. **ä¿æŒå®Œæ•´æ€§** - æ¶¦è‰²åçš„è¾“å‡ºå¿…é¡»åŒ…å«åŸæ–‡çš„æ‰€æœ‰å…³é”®ä¿¡æ¯');
    parts.push('3. **é€æ®µå¤„ç†** - å¯¹æ¯ä¸€æ®µéƒ½è¿›è¡Œé€‚å½“çš„ä¼˜åŒ–å’Œå»¶å±•');
    parts.push('4. **éªŒè¯é•¿åº¦** - è¾“å‡ºé•¿åº¦åº”è¯¥ä¸è¾“å…¥é•¿åº¦ç›¸å½“ï¼ˆæ ¹æ® level å¯èƒ½æ›´é•¿ï¼‰');
    parts.push('');
    parts.push('**å¦‚æœåŸæ–‡åŒ…å«å¤šä¸ªç‹¬ç«‹è¦ç‚¹/ä»»åŠ¡/éœ€æ±‚:**');
    parts.push('- æ¯ä¸ªè¦ç‚¹éƒ½éœ€è¦å•ç‹¬ä¼˜åŒ–å»¶å±•');
    parts.push('- ä¿æŒåŸæ–‡çš„ç»“æ„å’Œé¡ºåº');
    parts.push('- ä¸è¦åˆå¹¶æˆ–çœç•¥ä»»ä½•è¦ç‚¹');
    parts.push('');
    parts.push('---');
    parts.push('');
  }

  parts.push('```');
  parts.push(text);
  parts.push('```');
  parts.push('');

  // 14. Final execution reminder
  parts.push('---');
  parts.push('');
  parts.push('âš ï¸ **CRITICAL - ä¸¥æ ¼è¾“å‡ºçº¦æŸ** âš ï¸');
  parts.push('');
  parts.push('**ä½ å¿…é¡»ä¸”åªèƒ½è¾“å‡ºæ¶¦è‰²åçš„æ–‡æœ¬å†…å®¹, ç»å¯¹ä¸å…è®¸åŒ…å«:**');
  parts.push('- âŒ ä»»ä½•è§£é‡Šæ€§æ–‡å­— (å¦‚ "æˆ‘ç†è§£äº†", "è¿™æ˜¯æ¶¦è‰²ç»“æœ")');
  parts.push('- âŒ ä»»ä½•å…ƒè¯„è®º (å¦‚ "æ ¹æ®è¦æ±‚", "æŒ‰ç…§è§„åˆ™")');
  parts.push('- âŒ ä»»ä½•åˆ†éš”ç¬¦æˆ–æ ‡è®° (å¦‚ "---", "**ç»“æœ:**")');
  parts.push('- âŒ ä»»ä½•è¯Šæ–­ä¿¡æ¯ (å¦‚ "æ£€æµ‹åˆ°", "è¯†åˆ«ä¸º")');
  parts.push('- âŒ ä»»ä½•æ ¼å¼åŒ–æ ‡è®°å— (å¦‚ Markdown çš„ "âœ…", "ğŸ“Š" ç­‰è£…é¥°æ€§è¾“å‡º)');
  parts.push('- âŒ ä»»ä½•å¯’æš„æˆ–ç¤¼è²Œç”¨è¯­');
  parts.push('');
  parts.push('**æ­£ç¡®ç¤ºä¾‹:**');
  parts.push('è¾“å…¥: "çœ‹çœ‹ç»Ÿè®¡"');
  parts.push('âœ… æ­£ç¡®è¾“å‡º: "æŸ¥çœ‹æœ€è¿‘30å¤©çš„ç»Ÿè®¡æ•°æ®ï¼ŒæŒ‰æ—¶é—´/ç±»å‹/ç”¨æˆ·ç»´åº¦æ±‡æ€»"');
  parts.push('âŒ é”™è¯¯è¾“å‡º: "æˆ‘ç†è§£äº†ä½ çš„æ„æ€ã€‚\\n\\nè¿™æ˜¯æ¶¦è‰²ç»“æœ:\\n\\næŸ¥çœ‹æœ€è¿‘30å¤©..." (åŒ…å«æ— å…³æ–‡å­—)');
  parts.push('');
  parts.push('**å¦‚æœä½ æ— æ³•åšåˆ°åªè¾“å‡ºæ¶¦è‰²æ–‡æœ¬, é‚£ä¹ˆç›´æ¥è¾“å‡ºåŸæ–‡ä¸åšä¿®æ”¹.**');
  parts.push('');
  parts.push('---');
  parts.push('');
  parts.push('# æ‰§è¡Œæµç¨‹');
  parts.push('');
  parts.push('1. **è¯†åˆ«æ„å›¾**: åˆ¤æ–­ç±»å‹ (æŸ¥è¯¢/æ‰§è¡Œ/è¯Šæ–­/å»ºè®®/å¯¹æ¯”)');
  parts.push('2. **è¡¥å…¨ä¸Šä¸‹æ–‡**: æ£€æŸ¥ 5W1H, è¡¥å……ç¼ºå¤±ä¿¡æ¯');
  parts.push('3. **å»¶å±•ä¼˜åŒ–**: light(çº é”™) | medium(è¡¥5W1H) | deep(è¯¦ç»†æ–¹æ¡ˆ)');
  parts.push('4. **ä¸¥æ ¼éµå®ˆçº¦æŸ**: ä¸æ”¹ä»£ç /ä¸å‘æ˜äº‹å®/å¿ äºåŸæ„/ä¿ç•™å…³é”®ä¿¡æ¯');
  parts.push('');
  parts.push('**ä½ çš„ä¸‹ä¸€æ¡æ¶ˆæ¯å°†è¢«ç›´æ¥è¿”å›ç»™ç”¨æˆ·ï¼Œç«‹å³å¼€å§‹è¾“å‡ºæ¶¦è‰²åçš„çº¯æ–‡æœ¬ï¼ˆä¸è¦ç¡®è®¤ï¼Œä¸è¦"æˆ‘æ˜ç™½äº†"ï¼‰:**');

  return parts.join('\n');
}

