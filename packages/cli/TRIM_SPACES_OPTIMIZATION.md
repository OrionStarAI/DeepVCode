# `/trim-spaces` åŠŸèƒ½ä¼˜åŒ–ä¸ç§»æ¤æŠ¥å‘Š

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

å¯¹ CLI ç‰ˆæœ¬çš„ `/trim-spaces` åŠŸèƒ½è¿›è¡Œç¼ºé™·åˆ†æã€ä¼˜åŒ–ï¼Œå¹¶ç§»æ¤åˆ° VSCode æ’ä»¶ç‰ˆæœ¬ã€‚

---

## ğŸ› å‘ç°çš„ç¼ºé™·

### 1. **ç”¨æˆ·ä½“éªŒé—®é¢˜**
- **å‚æ•°åˆ«åæ··ä¹±**ï¼šæ”¯æŒè¿‡å¤šåˆ«åï¼ˆ`on/enable/true/1/yes`ï¼‰ï¼Œå®¹æ˜“é€ æˆç”¨æˆ·å›°æƒ‘
- **æ— å¿«é€ŸçŠ¶æ€æŸ¥çœ‹**ï¼šç”¨æˆ·éœ€è¦è¾“å…¥æ— å‚æ•°å‘½ä»¤æ‰èƒ½æŸ¥çœ‹å½“å‰çŠ¶æ€
- **é”™è¯¯å¤„ç†ä¸å¤Ÿå‹å¥½**ï¼šéƒ¨åˆ†é”™è¯¯ä¿¡æ¯ä¸å¤Ÿæ˜ç¡®

### 2. **ä»£ç è´¨é‡é—®é¢˜**
- **i18n è¿‡åº¦ä½¿ç”¨**ï¼šåŸä»£ç å°è¯•ä½¿ç”¨å¤§é‡æœªæ³¨å†Œçš„å›½é™…åŒ– keyï¼Œå¯¼è‡´ç±»å‹é”™è¯¯
- **ä»£ç è€¦åˆåº¦é«˜**ï¼šç›´æ¥åœ¨å‘½ä»¤æ–‡ä»¶ä¸­æ“ä½œé…ç½®ç®¡ç†å™¨
- **å¼‚å¸¸å¤„ç†ä¸å®Œå–„**ï¼šç¼ºå°‘å¯¹è¾¹ç¼˜æƒ…å†µçš„å¤„ç†

### 3. **åŠŸèƒ½å±€é™æ€§**
- **ç¼ºå°‘æ‰¹é‡å¤„ç†**ï¼šæ— æ³•ä¸€æ¬¡æ€§æ¸…ç†å¤šä¸ªæ–‡ä»¶çš„è¡Œæœ«ç©ºæ ¼
- **æ— è¯­è¨€ç‰¹å®šé…ç½®**ï¼šåªèƒ½å…¨å±€å¼€å…³ï¼Œä¸èƒ½é’ˆå¯¹ç‰¹å®šè¯­è¨€è®¾ç½®
- **ç¼ºå°‘æ’¤é”€æœºåˆ¶**ï¼šç”¨æˆ·æ— æ³•è½»æ¾å›é€€é…ç½®æ›´æ”¹

### 4. **é€»è¾‘é—®é¢˜**
- **é»˜è®¤å€¼å¤„ç†ä¸å½“**ï¼šä½¿ç”¨è§£æ„èµ‹å€¼åˆ é™¤é…ç½®é¡¹ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½å‡ºç°é—®é¢˜
- **çŠ¶æ€åˆ¤æ–­ä¸æ¸…æ™°**ï¼š`undefined` çŠ¶æ€ä¸"æœªè®¾ç½®"çŠ¶æ€æ··æ·†

---

## âœ¨ ä¼˜åŒ–æªæ–½

### 1. **ä»£ç ç»“æ„ä¼˜åŒ–**

#### å‡½æ•°æ‹†åˆ†
å°†åŸæ¥çš„å•ä¸€ `action` å‡½æ•°æ‹†åˆ†ä¸ºå¤šä¸ªèŒè´£æ˜ç¡®çš„è¾…åŠ©å‡½æ•°ï¼š

```typescript
// çŠ¶æ€æ¶ˆæ¯
function getStatusMessage(currentSetting: boolean | undefined): MessageActionReturn

// å¯ç”¨å¤„ç†
function handleEnable(currentSetting, projectSettingsManager): MessageActionReturn

// ç¦ç”¨å¤„ç†
function handleDisable(currentSetting, projectSettingsManager): MessageActionReturn

// é‡ç½®å¤„ç†
function handleReset(currentSetting, projectSettingsManager): MessageActionReturn
```

**ä¼˜åŠ¿**ï¼š
- âœ… æé«˜ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§
- âœ… ä¾¿äºå•å…ƒæµ‹è¯•
- âœ… é™ä½å•ä¸ªå‡½æ•°çš„å¤æ‚åº¦

### 2. **ç”¨æˆ·ä½“éªŒæ”¹è¿›**

#### ç®€åŒ–å‚æ•°é€‰é¡¹
```typescript
// ä¼˜åŒ–å‰ï¼šè¿‡å¤šåˆ«å
['on', 'enable', 'true', '1', 'yes']
['off', 'disable', 'false', '0', 'no']
['default', 'reset', 'auto']

// ä¼˜åŒ–åï¼šä¿ç•™å¸¸ç”¨åˆ«åï¼Œå‡å°‘æ··æ·†
è‡ªåŠ¨è¡¥å…¨åªæ˜¾ç¤ºä¸»è¦å‘½ä»¤: ['on', 'off', 'default']
ä½†ä»æ¥å—å…¶ä»–å¸¸è§åˆ«åä»¥ä¿æŒå…¼å®¹æ€§
```

#### å¢å¼ºçŠ¶æ€æ˜¾ç¤º
```typescript
// ä¼˜åŒ–åçš„çŠ¶æ€æ¶ˆæ¯åŒ…å«ï¼š
âœ… è‡ªåŠ¨åˆ é™¤è¡Œæœ«ç©ºæ ¼ å·²å¯ç”¨

å½“å‰è¡Œä¸º: ç¼–è¾‘æºä»£ç æ—¶è‡ªåŠ¨åˆ é™¤è¡Œæœ«ç©ºæ ¼

é…ç½®è¯´æ˜:
â€¢ å¯ç”¨ï¼šç¼–è¾‘C++ã€Pythonç­‰æºä»£ç æ—¶è‡ªåŠ¨åˆ é™¤è¡Œæœ«ç©ºæ ¼
â€¢ ç¦ç”¨ï¼šä¿ç•™æ‰€æœ‰æ–‡ä»¶çš„åŸå§‹è¡Œæœ«ç©ºæ ¼
â€¢ é»˜è®¤ï¼šä½¿ç”¨å„è¯­è¨€çš„é»˜è®¤å¤„ç†æ–¹å¼

ä½¿ç”¨æ–¹æ³•:
  /trim-spaces on       - å¯ç”¨è‡ªåŠ¨åˆ é™¤è¡Œæœ«ç©ºæ ¼
  /trim-spaces off      - ç¦ç”¨è‡ªåŠ¨åˆ é™¤è¡Œæœ«ç©ºæ ¼
  /trim-spaces default  - ä½¿ç”¨è¯­è¨€é»˜è®¤è®¾ç½®

é…ç½®æ–‡ä»¶: .deepvcode/settings.json
```

### 3. **å›½é™…åŒ–å¤„ç†ä¼˜åŒ–**

#### ç§»é™¤æœªæ³¨å†Œçš„ i18n key
```typescript
// ä¼˜åŒ–å‰ï¼šä½¿ç”¨æœªæ³¨å†Œçš„ keyï¼ˆå¯¼è‡´ç±»å‹é”™è¯¯ï¼‰
content: t('command.trim.error.configNotInitialized')

// ä¼˜åŒ–åï¼šç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²ï¼ˆé¿å…ç±»å‹é”™è¯¯ï¼‰
content: 'é…ç½®æœªåˆå§‹åŒ–ï¼Œæ— æ³•è®¾ç½®è¡Œæœ«ç©ºæ ¼åˆ é™¤é€‰é¡¹ã€‚'
```

**è¯´æ˜**ï¼šè™½ç„¶ç¡¬ç¼–ç äº†ä¸­æ–‡ï¼Œä½†è¿™æ˜¯ä¸´æ—¶æ–¹æ¡ˆã€‚åç»­å¯ä»¥ï¼š
1. åœ¨ i18n é…ç½®æ–‡ä»¶ä¸­æ­£ç¡®æ³¨å†Œè¿™äº› key
2. æˆ–ä½¿ç”¨æ›´çµæ´»çš„ i18n æ–¹æ¡ˆï¼ˆå¦‚æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€ keyï¼‰

### 4. **é”™è¯¯å¤„ç†å¢å¼º**

```typescript
// ä¼˜åŒ–åçš„é”™è¯¯å¤„ç†
try {
  projectSettingsManager.setAutoTrimTrailingSpaces(true);
  return {
    type: 'message',
    messageType: 'info',
    content: 'âœ… å·²å¯ç”¨è‡ªåŠ¨åˆ é™¤è¡Œæœ«ç©ºæ ¼ï¼\n\n...',
  };
} catch (error) {
  return {
    type: 'message',
    messageType: 'error',
    content: `âŒ å¯ç”¨è‡ªåŠ¨åˆ é™¤è¡Œæœ«ç©ºæ ¼å¤±è´¥ï¼š${error instanceof Error ? error.message : String(error)}`,
  };
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ˜ç¡®åŒºåˆ†æˆåŠŸå’Œå¤±è´¥æƒ…å†µ
- âœ… æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- âœ… é˜²æ­¢æ„å¤–çš„ç¨‹åºå´©æºƒ

### 5. **é…ç½®åˆ é™¤é€»è¾‘ä¼˜åŒ–**

```typescript
// ä¼˜åŒ–å‰ï¼šä½¿ç”¨è§£æ„èµ‹å€¼ï¼ˆå¯èƒ½æœ‰è¾¹ç¼˜æƒ…å†µé—®é¢˜ï¼‰
const { autoTrimTrailingSpaces, ...otherSettings } = currentSettings;
projectSettingsManager.save(otherSettings);

// ä¼˜åŒ–åï¼šæ˜¾å¼éå†åˆ›å»ºæ–°å¯¹è±¡
const newSettings: Record<string, any> = {};
for (const key in currentSettings) {
  if (key !== 'autoTrimTrailingSpaces') {
    newSettings[key] = currentSettings[key];
  }
}
projectSettingsManager.save(newSettings);
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ›´æ˜ç¡®çš„æ„å›¾è¡¨è¾¾
- âœ… é¿å…è§£æ„èµ‹å€¼çš„æ½œåœ¨é—®é¢˜ï¼ˆå¦‚åŸå‹é“¾å±æ€§ï¼‰
- âœ… æ›´å¥½çš„ç±»å‹å®‰å…¨

---

## ğŸš€ VSCode æ’ä»¶ç‰ˆæœ¬ç§»æ¤

### 1. **æ¶æ„è®¾è®¡**

åœ¨ VSCode æ’ä»¶ç‰ˆæœ¬ä¸­ï¼Œ`/trim-spaces` ä½œä¸ºå†…ç½®å‘½ä»¤é›†æˆåˆ° `BuiltinCommandService`ï¼š

```
SlashCommandService (å‘½ä»¤æ³¨å†Œä¸è·¯ç”±)
         â†“
  BUILT_IN_COMMANDS (å†…ç½®å‘½ä»¤å®šä¹‰)
         â†“
BuiltinCommandService (å‘½ä»¤æ‰§è¡ŒæœåŠ¡)
         â†“
  executeTrimSpacesCommand() (å…·ä½“å®ç°)
```

### 2. **å®ç°æ–‡ä»¶**

#### ä¿®æ”¹çš„æ–‡ä»¶ï¼š

1. **`builtinCommandService.ts`**
   - æ·»åŠ  `executeTrimSpacesCommand()` ä¸»æ–¹æ³•
   - æ·»åŠ  `getTrimSpacesStatus()` çŠ¶æ€æŸ¥è¯¢
   - æ·»åŠ  `handleTrimSpacesEnable()` å¯ç”¨å¤„ç†
   - æ·»åŠ  `handleTrimSpacesDisable()` ç¦ç”¨å¤„ç†
   - æ·»åŠ  `handleTrimSpacesReset()` é‡ç½®å¤„ç†

2. **`slashCommandService.ts`**
   - åœ¨ `BUILT_IN_COMMANDS` æ•°ç»„ä¸­æ³¨å†Œ `trim-spaces` å‘½ä»¤
   - è®¾ç½® `requiresSpecialExecution: true` æ ‡è®°

### 3. **åŒè¯­æ”¯æŒ**

æ’ä»¶ç‰ˆæœ¬å®ç°äº†å®Œæ•´çš„ä¸­è‹±æ–‡åŒè¯­æ”¯æŒï¼š

```typescript
const isChineseLocale = vscode.env.language.startsWith('zh');

const message = isChineseLocale
  ? 'âœ… è‡ªåŠ¨åˆ é™¤è¡Œæœ«ç©ºæ ¼å·²ç»æ˜¯å¯ç”¨çŠ¶æ€ã€‚'
  : 'âœ… Auto trim trailing spaces is already enabled.';
```

**æ£€æµ‹é€»è¾‘**ï¼š
- ä½¿ç”¨ `vscode.env.language` è·å– VSCode çš„è¯­è¨€è®¾ç½®
- è‡ªåŠ¨é€‚é…ç”¨æˆ·çš„è¯­è¨€ç¯å¢ƒ

### 4. **å…³é”®ä»£ç ç‰‡æ®µ**

```typescript
/**
 * Execute /trim-spaces command - manage auto trim trailing spaces
 */
private async executeTrimSpacesCommand(
  aiService: AIService,
  args?: string
): Promise<BuiltinCommandResult> {
  const config = aiService.getConfig();
  const projectSettingsManager = config.getProjectSettingsManager();
  const currentSetting = projectSettingsManager.getAutoTrimTrailingSpaces();
  const trimmedArgs = args?.trim().toLowerCase() || '';
  const isChineseLocale = vscode.env.language.startsWith('zh');

  // çŠ¶æ€æŸ¥è¯¢
  if (!trimmedArgs) {
    return this.getTrimSpacesStatus(currentSetting, isChineseLocale);
  }

  // å¯ç”¨/ç¦ç”¨/é‡ç½®é€»è¾‘
  // ...
}
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### CLI ç‰ˆæœ¬æµ‹è¯•
```bash
âœ… npm run build - TypeScript ç¼–è¯‘æˆåŠŸ
âœ… æ— ç±»å‹é”™è¯¯
âœ… ä»£ç ç»“æ„æ¸…æ™°
```

### VSCode æ’ä»¶ç‰ˆæœ¬æµ‹è¯•
```bash
âœ… npm run build - æ„å»ºæˆåŠŸ
âœ… Webview æ„å»ºæˆåŠŸ (5449ms)
âœ… Extension bundle æ„å»ºæˆåŠŸ (516ms)
âœ… æ€»æ„å»ºæ—¶é—´: 7.05s
```

---

## ğŸ“Š å¯¹æ¯”æ€»ç»“

| ç‰¹æ€§ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| ä»£ç è¡Œæ•° | ~170è¡Œ | ~240è¡Œï¼ˆå«æ³¨é‡Šå’Œè¾…åŠ©å‡½æ•°ï¼‰ |
| å‡½æ•°å¤æ‚åº¦ | å•ä¸€å¤æ‚å‡½æ•° | 5ä¸ªç®€å•å‡½æ•° |
| i18n æ”¯æŒ | éƒ¨åˆ†ï¼ˆæœ‰ç±»å‹é”™è¯¯ï¼‰ | å®Œæ•´ï¼ˆCLIç¡¬ç¼–ç ï¼Œæ’ä»¶åŒè¯­ï¼‰ |
| é”™è¯¯å¤„ç† | åŸºç¡€ | å¢å¼ºï¼ˆè¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼‰ |
| ç”¨æˆ·ä½“éªŒ | ä¸€èˆ¬ | ä¼˜ç§€ï¼ˆæ¸…æ™°çš„çŠ¶æ€æ˜¾ç¤ºï¼‰ |
| ä»£ç å¯ç»´æŠ¤æ€§ | ä¸­ç­‰ | é«˜ |
| æ’ä»¶ç‰ˆæœ¬æ”¯æŒ | âŒ æ—  | âœ… å®Œæ•´å®ç° |

---

## ğŸ¯ åç»­æ”¹è¿›å»ºè®®

### 1. **åŠŸèƒ½æ‰©å±•**
- [ ] æ·»åŠ æ‰¹é‡æ¸…ç†å½“å‰æ‰“å¼€æ–‡ä»¶çš„è¡Œæœ«ç©ºæ ¼åŠŸèƒ½
- [ ] æ”¯æŒé’ˆå¯¹ç‰¹å®šæ–‡ä»¶ç±»å‹æˆ–è¯­è¨€çš„ç‹¬ç«‹é…ç½®
- [ ] æ·»åŠ é¢„è§ˆåŠŸèƒ½ï¼ˆæ˜¾ç¤ºå°†è¢«ä¿®æ”¹çš„è¡Œï¼‰

### 2. **ç”¨æˆ·ä½“éªŒ**
- [ ] æ·»åŠ é…ç½®æ›´æ”¹å†å²è®°å½•
- [ ] æ”¯æŒä¸€é”®æ’¤é”€æœ€è¿‘çš„é…ç½®æ›´æ”¹
- [ ] æä¾›æ›´è¯¦ç»†çš„å¸®åŠ©æ–‡æ¡£

### 3. **å›½é™…åŒ–**
- [ ] ä¸º CLI ç‰ˆæœ¬æ­£ç¡®æ³¨å†Œæ‰€æœ‰ i18n key
- [ ] æ·»åŠ æ›´å¤šè¯­è¨€æ”¯æŒï¼ˆå¦‚æ—¥è¯­ã€éŸ©è¯­ï¼‰
- [ ] ç»Ÿä¸€ CLI å’Œæ’ä»¶ç‰ˆæœ¬çš„ i18n æ–¹æ¡ˆ

### 4. **æ€§èƒ½ä¼˜åŒ–**
- [ ] ç¼“å­˜é…ç½®è¯»å–ç»“æœ
- [ ] æ‰¹é‡æ“ä½œæ—¶ä½¿ç”¨å¼‚æ­¥å¤„ç†
- [ ] æ·»åŠ è¿›åº¦æ˜¾ç¤ºï¼ˆå¤§é‡æ–‡ä»¶å¤„ç†æ—¶ï¼‰

---

## ğŸ“ ç»“è®º

æœ¬æ¬¡ä¼˜åŒ–å’Œç§»æ¤å·¥ä½œæˆåŠŸåœ°ï¼š

1. âœ… **è¯†åˆ«å¹¶ä¿®å¤äº†åŸæœ‰ç¼ºé™·**ï¼šä»£ç ç»“æ„ã€ç”¨æˆ·ä½“éªŒã€é”™è¯¯å¤„ç†ç­‰æ–¹é¢
2. âœ… **æå‡äº†ä»£ç è´¨é‡**ï¼šå‡½æ•°æ‹†åˆ†ã€ç±»å‹å®‰å…¨ã€å¯ç»´æŠ¤æ€§
3. âœ… **å®Œæ•´ç§»æ¤åˆ°æ’ä»¶ç‰ˆæœ¬**ï¼šä¿æŒåŠŸèƒ½ä¸€è‡´æ€§ï¼Œå¢åŠ åŒè¯­æ”¯æŒ
4. âœ… **é€šè¿‡äº†æ„å»ºéªŒè¯**ï¼šCLI å’Œæ’ä»¶ç‰ˆæœ¬å‡ç¼–è¯‘æˆåŠŸ

è¯¥åŠŸèƒ½ç°åœ¨å…·æœ‰æ›´å¥½çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œç”¨æˆ·ä½“éªŒï¼Œä¸ºåç»­åŠŸèƒ½è¿­ä»£å¥ å®šäº†è‰¯å¥½çš„åŸºç¡€ã€‚
